(()=>{"use strict";let e=document.getElementById("soundEfx");function t(e,t,i,n){n.beginPath(),n.arc(e,t,5*i,0,2*Math.PI,!1),n.fill(),n.closePath()}function i(){focused&&requestAnimationFrame(i),function(e){let i=e.length;for(;i--;){let n=e[i],s=n.x,o=n.y,a=n.size;t(s,o,a,ctx),n.dy-=options.gravity,n.x-=n.dx,n.y-=n.dy,n.size-=.05,(e[i].size<.3||Math.random()<options.consistency)&&(t(s,o,a,ctx),e.splice(i,1))}}(items)}function n(e,t,i){for(let n=0;n<30;n++){let n=Math.random()*Math.PI,s=(Math.random()<.5?3:-3)*(3*Math.random())*options.scatter,o=(Math.random()<.5?3:-3)*(3*Math.random())*options.scatter;i.push({x:e,y:t,dx:s+mouse.dx,dy:o+mouse.dy,size:n})}}let s=document.querySelector(".tryAgain"),o=document.querySelector(".score"),a=document.querySelector(".highestScoreData");class l{constructor(){this.spriteWidth=396,this.spriteHeight=582,this.sizeModifier=.2*Math.random()+.4,this.width=this.spriteWidth*this.sizeModifier/3,this.height=this.spriteHeight*this.sizeModifier/3,this.x=canvas.width,this.y=Math.random()*(canvas.height-this.height),this.directionX=2*Math.random()+2+.5*Math.floor(kills/10),this.directionY=2*Math.random(),this.markedForDeletion=!1,this.image=new Image,this.image.src="./Sprites/ghostspritesheet.png",this.frame=0,this.maxFrame=8,this.timeSinceStep=0,this.stepInterval=100,this.randomColors=[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],this.color="rgb("+this.randomColors[0]+","+this.randomColors[1]+","+this.randomColors[2]+")",mediaQuery.matches&&(this.directionX=.5+.25*Math.floor(kills/10),this.directionY=Math.random())}update(e){(this.y<0||this.y>canvas.height-this.height)&&(this.directionY=-1*this.directionY),this.x-=this.directionX,this.y+=this.directionY,this.x<0-this.width&&(this.markedForDeletion=!0),this.timeSinceStep+=e,this.timeSinceStep>this.stepInterval&&(this.frame>this.maxFrame?this.frame=0:this.frame++,this.timeSinceStep=0),this.x<0-this.width&&(gameEnd=!0,highestScore=null==localStorage.getItem(localStorageName)?0:localStorage.getItem(localStorageName),highestScore=Math.max(kills,highestScore),localStorage.setItem(localStorageName,highestScore),rayGun.style.display="none",canvas.style.display="none",collisionCanvas.style.display="none",s.style.display="flex",o.textContent=`Your score was ${kills}.`,a.textContent=`Your highest score was ${highestScore}`)}draw(){collisionCtx.fillStyle=this.color,collisionCtx.fillRect(this.x,this.y,this.width,this.height),ctx.drawImage(this.image,this.frame*this.spriteWidth,0,this.spriteWidth,this.spriteHeight,this.x,this.y,this.width,this.height)}}let c=document.getElementById("bgmEfx");function d(){if("block"==canvas.style.display&&0==c.checked){let e=new Audio("backgroundsound.mp3");e.play(),e.setAttribute("id","backgroundSound"),e.loop=!0}}window.canvas=document.getElementById("canvas"),window.ctx=canvas.getContext("2d"),window.collisionCanvas=document.getElementById("collisionCanvas"),window.collisionCtx=collisionCanvas.getContext("2d"),window.rayGun=document.getElementById("raygun"),window.items=[],window.kills=0,window.tone="#ffffff",collisionCanvas.width=window.innerWidth,collisionCanvas.height=window.innerHeight,canvas.width=window.innerWidth,canvas.height=window.innerHeight,ctx.font="40px Alien",window.focused=!1,window.clicked=!1,window.gameEnd=!1,window.mouse={x:0,y:0,dx:0,dy:0,px:0,py:0},window.options={scatter:0,gravity:.2,consistency:.04};let r=document.getElementById("removeEfx"),h=0,m=500,y=0,u=[];function g(e){ctx.clearRect(0,0,canvas.width,canvas.height),collisionCtx.clearRect(0,0,canvas.width,canvas.height);let t=e-y;y=e,h+=t,h>m&&(u.push(new l),h=0),ctx.font="25px Alien",ctx.fillStyle="white",ctx.fillText("Busts: "+kills,canvas.width/2,canvas.height/8),[...u].forEach((e=>e.update(t))),[...u].forEach((e=>e.draw())),u=u.filter((e=>!e.markedForDeletion)),gameEnd||requestAnimationFrame(g)}window.localStorageName="ghostbusters",window.highestScore=0,window.mediaQuery=window.matchMedia("(max-width: 1200px)"),canvas.addEventListener("mousemove",(e=>{document.getElementById("raygun").style.top=e.pageY+"px"})),canvas.addEventListener("click",(function(t){!function(){if("block"==canvas.style.display&&0==e.checked){let e=new Audio("raygunsound.mp3");e.play(),e.setAttribute("id","rayGunSound"),e.loop=!1}}(),function(){let e=document.getElementById("raygun");e.src="coloredraygunfire.png",setTimeout((function(){e.src="coloredraygun.png"}),100)}();const s=collisionCtx.getImageData(t.x,t.y,1,1).data;u.forEach((e=>{e.randomColors[0]===s[0]&&e.randomColors[1]===s[1]&&e.randomColors[2]===s[2]&&(e.markedForDeletion=!0,kills++,0==r.checked&&(focused?(clicked=!0,setTimeout((function(){clicked=!1}),100),mouse.x=t.pageX,mouse.y=t.pageY,ctx.fillStyle=tone,n(mouse.x,mouse.y,items),setTimeout((function(){ctx.clearRect(0,0,canvas.width,canvas.height)}),1e3)):(focused=!0,i())))}))}));let p=document.getElementById("startGameButton"),w=document.querySelector(".startGame"),f=document.getElementById("tryAgainButton"),x=document.querySelector(".tryAgain");f.addEventListener("click",(function(){mediaQuery.matches?(focused=!1,clicked=!1,gameEnd=!1,h=0,m=500,y=0,items=[],u=[],kills=0,canvas.style.display="block",collisionCanvas.style.display="block",x.style.display="none",rayGun.style.display="none",g(0)):(focused=!1,clicked=!1,gameEnd=!1,h=0,m=500,y=0,items=[],u=[],kills=0,canvas.style.display="block",collisionCanvas.style.display="block",x.style.display="none",rayGun.style.display="flex",g(0))})),p.addEventListener("click",(function(){mediaQuery.matches?(canvas.style.display="block",collisionCanvas.style.display="block",w.style.display="none",rayGun.style.display="none",d(),g(0)):(canvas.style.display="block",collisionCanvas.style.display="block",w.style.display="none",rayGun.style.display="flex",d(),g(0))})),canvas.onmousemove=function(e){if(clicked&&0==r.checked){let t=mouse.px-mouse.x,i=mouse.py-mouse.y;mouse={x:e.pageX,y:e.pageY,dx:Math.abs(t)>10?-10:t,dy:Math.abs(i)>10?-10:i,px:mouse.x,py:mouse.y},n(mouse.x,mouse.y,items)}};let v=document.querySelector(".screenRotation");console.log(screen.orientation),screen.orientation.onchange=function(e){"landscape-primary"!==screen.orientation.type?v.style.display="flex":v.style.display="none"},"landscape-primary"!==screen.orientation.type&&(v.style.display="flex");const k=()=>{canvas.width=window.innerWidth,canvas.height=window.innerHeight,collisionCanvas.width=window.innerWidth,collisionCanvas.height=window.innerHeight};k(),window.addEventListener("resize",k)})();